# websocket-messenger

Сервис для обмена моментальными сообщениями.

## Основные сущности

### Чат (`Chat`)

Объединение пользователей в группу, обменивающуюся сообщениями.
Чат имеет следующие параметры:

1. Идентификатор (`chat_id`)
2. Название (`name`)
3. Идентификатор инициатора (`initiator`)
4. Список участников (`participants`)
5. Историю сообщений (`history`)
6. Идентификатор последнего сообщения (`last_message`)
7. Время последней активности в чате (`last_activity_timestamp`)
8. Признак удаления (`deleted`)

### Сообщение (`Message`)

Текстовое сообщение, привязанное к чату, отправленное пользователем.
Все сообщения в рамках чата являются широковещательными. Все участники чата получают уведомления о новом сообщении.
Сообщение имеет следующие параметры:

1. Идентификатор (`message_id`)
2. Идентификатор чата (`chat_id`)
3. Идентификатор отправителя (`sender`)
4. Идентификатор сообщение, ответом на которое было сформировано текущее сообщение (`reply_to`)
5. Текст сообщения (`content`)
6. Вложения (`attachments`)
7. Статус (`status`): `sent`, `received`, `read`
8. Время создания (`created`)
9. Время обновления (`updated`)

### Вложение (`Attachment`)

Вложение, привязанное к сообщению. Вложение представляет из сбя ссылку на медиафайл, указанного типа.
Вложение имеет следующие параметры:

1. Идентификатор (`attachment_id`)
2. Время создания (`created`)
3. Ссылка на вложение (`url`)
4. Название (`name`)
5. Тип вложения (`content_type`): `image`, `audio`, `video`, `file`

## Основные методы

1. Создание чата: `POST /chats`
2. Получение списка чатов, доступных для пользователя: `GET /chats`
3. Получение списка сообщений в чате: `GET /chats/{chat_id}/messages`
4. Отправка сообщения в чат: `POST /chats/{chat_id}/messages`
5. Подтверждение получения сообщения: `PUT /messages/{message_id}/receive`
6. Подтверждение прочтения сообщения: `PUT /messages/{message_id}/read`
7. Удаление сообщения: `DELETE /messages/{message_id}`
8. Подписка на моментальное получение новых сообщений: (`websocket`): `/subscriptions`

## Установка

```bash
pip install -r requirements.txt
```

## Запуск

### Локальный запуск

```bash
uvicorn --app-dir ./src/ presentation.api.main:app --host 0.0.0.0 --port 80 --reload
```

### Запуск в docker-compose

```bash
docker compose up --build -d
```

## Настройка среды разработки

### Установка зависимостей

```bash
pip install -r requirements-dev.txt
```

### Настройка `pre-commit`

```bash
pre-commit install
```
